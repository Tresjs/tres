---
title: useLoop
description: useLoop provides a convenient access to the render loop of the TresJS scene.
---

The `useLoop` composable allows you to register callbacks that run before and after each render cycle, or take complete control of the rendering process within `TresCanvas` components.

::dotted-diagram
  ::diagrams-render-loop
  ::
::

## Usage

```ts
import { useLoop } from '@tresjs/core'

const { onBeforeRender, onRender } = useLoop()

onBeforeRender(() => {
  console.log('before render')
})

onRender(() => {
  console.log('after render')
})
```



### Priority

The `onBeforeRender` and `onRender` callbacks can be registered with a priority. The priority is a number that determines the order in which the callbacks are executed. The default priority is 0.

::code-group

```ts [onBeforeRender]
onBeforeRender(() => {
  console.log('earlier before render')
}, -10)

onBeforeRender(() => {
  console.log('just before render')
})

onBeforeRender(() => {
  console.log('even closer before render')
}, 10)
```

```ts [onRender]
onRender(() => {
  console.log('even closer after render')
}, -10)

onRender(() => {
  console.log('just after render')
})

onRender(() => {
  console.log('later after render')
}, 10)
```
::



### Register update callbacks

The most common use of `onBeforeRender` is to register update callbacks for animations, such as rotating or moving objects in the scene.

::code-group

```vue [AnimatedCube.vue]
<script setup lang="ts">
import { useLoop } from '@tresjs/core'

const { onBeforeRender } = useLoop()

const cube = ref<Mesh>()

// Frame-rate independent animation using delta time
onBeforeRender(({ delta, elapsed }) => {
  if (cube.value) {
    // Smooth rotation based on frame time
    cube.value.rotation.y += delta * 2 // 2 radians per second
    
    // Oscillating movement based on elapsed time
    cube.value.position.y = Math.sin(elapsed * 3) * 0.5
  }
})
</script>

<template>
  <TresMesh ref="cube">
    <TresBoxGeometry :args="[1, 1, 1]" />
    <TresMeshNormalMaterial />
  </TresMesh>
</template>
```


```vue [App.vue]
<script setup lang="ts">
import { TresCanvas } from '@tresjs/core'
import AnimatedCube from './AnimatedCube.vue'
</script>

<template>
  <TresCanvas>
    <AnimatedCube />
  </TresCanvas>
</template>
```

::

### Callback Parameters

Both `onBeforeRender` and `onRender` callbacks receive a context object containing timing information and access to the TresJS context:

```ts
onBeforeRender(({ delta, elapsed, renderer, camera, scene, sizes, invalidate, advance }) => {
  // Timing information
  console.log('Time since last frame:', delta) // in seconds
  console.log('Total elapsed time:', elapsed) // in seconds
  
  // TresJS context access
  console.log('Current camera:', camera.value)
  console.log('Scene:', scene.value)
  console.log('Canvas size:', sizes.width.value, sizes.height.value)
  
  // Control methods
  invalidate() // Mark scene for re-render (useful in on-demand mode)
  advance()   // Manually advance one frame (useful in manual mode)
})
```

#### Available Parameters

:::field-group
  ::::field{name="delta" type="number"}
  Time in seconds since the last frame. Perfect for frame-rate independent animations.
  ::::

  ::::field{name="elapsed" type="number"}
  Total elapsed time in seconds since the render loop started. Useful for time-based effects.
  ::::

  ::::field{name="renderer" type="TresRenderer"}
  The Three.js WebGL renderer instance. Access to all renderer methods and properties.
  ::::

  ::::field{name="camera" type="ComputedRef<Camera | undefined>"}
  The currently active camera in the scene. Reactive reference that updates when camera changes.
  ::::

  ::::field{name="scene" type="ShallowRef<TresScene>"}
  The Three.js scene object containing all 3D objects.
  ::::

  ::::field{name="sizes" type="SizesType"}
  Reactive size information including width, height, and pixel ratio of the canvas.
  ::::

  ::::field{name="invalidate" type="() => void"}
  Function to mark the scene as needing an update in the next frame. Particularly useful in on-demand rendering mode.
  ::::

  ::::field{name="advance" type="() => void"}
  Function to manually advance the render loop by one frame. Especially useful in manual rendering mode.
  ::::

  ::::field{name="controls" type="Ref<TresControl | null>"}
  Reference to the current camera controls (if any). Useful for camera-based animations.
  ::::

  ::::field{name="events" type="EventManager"}
  The event manager instance for handling pointer interactions with 3D objects.
  ::::
:::

### Take Over the Render Loop

You can take complete control of the rendering process by using the `render` method from `useLoop`. This allows you to implement custom rendering logic, post-processing effects, or conditional rendering.

```ts
import { useLoop } from '@tresjs/core'

const { render } = useLoop()

// Take over the render loop with custom logic
render(({ renderer, scene, camera }) => {
  // Your custom rendering logic here
  renderer.render(scene, camera)
})
```

#### Custom Rendering Example

Here's an example showing how to implement custom rendering with multiple passes:

```vue
<script setup lang="ts">
import { useLoop } from '@tresjs/core'
import { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js'
import { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js'

const { render } = useLoop()

// Setup post-processing composer
const composer = new EffectComposer()

render(({ renderer, scene, camera }) => {
  // Custom rendering with post-processing
  if (composer.passes.length === 0) {
    const renderPass = new RenderPass(scene, camera)
    composer.addPass(renderPass)
  }
  
  // Render with post-processing
  composer.render()
  
  // Or implement conditional rendering
  if (shouldRender.value) {
    renderer.render(scene, camera)
  }
})
</script>
```

::warning
When you take over the render loop, you become responsible for:
- Manually calling `renderer.render(scene, camera)` 
- Handling conditional rendering logic yourself
- Managing any post-processing effects
- Ensuring proper frame timing and performance

The built-in render modes (`always`, `on-demand`, `manual`) will be bypassed when using custom rendering.
::

#### Render Method Parameters

The `render` callback receives the same context object as other loop callbacks:

:::field-group
  ::::field{name="renderer" type="TresRenderer"}
  The Three.js WebGL renderer instance for manual rendering calls.
  ::::

  ::::field{name="scene" type="ShallowRef<TresScene>"}
  The Three.js scene object to render.
  ::::

  ::::field{name="camera" type="ComputedRef<Camera | undefined>"}
  The currently active camera for rendering.
  ::::

  ::::field{name="delta" type="number"}
  Time since last frame for frame-rate independent logic.
  ::::

  ::::field{name="elapsed" type="number"}
  Total elapsed time since render loop started.
  ::::
:::